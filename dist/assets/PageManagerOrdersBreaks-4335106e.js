import{u as h}from"./orders-break.store-7f33132c.js";import{d as N,f as b,g as o,a as e,o as c,m as g,N as y,i as w,j as B,k as x,c as v,w as u,b as C,l as U,n as D,q as F,s as O}from"./index-16c8c699.js";import{N as R,a as z}from"./Skeleton-78601b56.js";import{u as M}from"./orderTypes.store-7e5e6061.js";import{N as S}from"./Input-83a63403.js";import{N as f,a as T}from"./FormItem-83cee67d.js";import{N as q}from"./InputNumber-8f2ea8ca.js";import{N as I}from"./Select-17150864.js";import{N as V}from"./Divider-83f7740d.js";import"./order.service-7605b746.js";import"./Suffix-0db10a3f.js";import"./use-locale-c61c26dc.js";import"./get-slot-1efb97e5.js";import"./ChevronRight-ab09ccdf.js";import"./Forward-81f3c204.js";import"./Empty-bc98c478.js";import"./Add-092ffdda.js";import"./cssr-f76ec62b.js";const $={class:"table-orders-stopped"},j=N({__name:"TableOrdersBreak",props:{tableData:{}},emits:["change","stop","restore"],setup(m,{emit:p}){const s=n({change:t=>p("change",t),stop:t=>p("stop",t),restore:t=>p("restore",t)});function n(t){return[{title:"Код",key:"code",sorter:"default"},{title:"Название",key:"name",sorter:"default"},{title:"Дата начала",key:"date_start",sorter:"default"},{title:"Дата сдачи",key:"date_end",sorter:"default"},{title:"Тип",key:"type.name",sorter:"default"},{title:"Стоимость",key:"price",sorter:"default"},{title:"Брак",key:"break.name",sorter:"default"},{title:"Комментарий",key:"comment",sorter:"default"},{title:"Действия",key:"actions",width:110,render(r){return[g(y,{type:"default",size:"small",style:{marginRight:"6px"},onClick:()=>t.change(r.id)},{default:()=>"Изменить"}),g(y,{type:"primary",size:"small",style:{marginRight:"6px"},onClick:()=>t.restore(r.id)},{default:()=>"Востановить"}),g(y,{type:"error",size:"small",style:{marginRight:"6px"},onClick:()=>t.stop(r.id)},{default:()=>"Снять с произодства"})]}}]}return(t,r)=>(c(),b("div",$,[o(e(R),{"single-line":!1,data:t.tableData,columns:e(s),pagination:{pageSize:30},bordered:!0},null,8,["data","columns"])]))}}),E=h();function L(m){const p={name:{required:!0,message:"Введите название заказа"},type_id:{required:!0,message:"Выбирете тип заказа"}},s=w([]),n=B({name:"",type_id:void 0,price:0,comment:""});return x(async()=>{const t=M();s.value=await t.getForSelect(),n.type_id=s.value[0].value;const r=E.findById(m);r&&(n.name=r.name,n.type_id=r.type.id,n.price=r.price,n.comment=r.comment)}),{rules:p,options:s,formValues:n}}const P=N({__name:"FormOrderBreakUpdate",props:{id:{}},emits:["done"],setup(m,{emit:p}){const s=m,n=h(),t=w(),{options:r,rules:_,formValues:l}=L(s.id);function k(){var i;(i=t.value)==null||i.validate(async a=>{a||(await n.update(s.id,l),p("done"))})}return(i,a)=>(c(),v(e(T),{ref_key:"orderUpdateFormRef",ref:t,rules:e(_),model:e(l)},{default:u(()=>[o(e(f),{label:"Название заказа",path:"name"},{default:u(()=>[o(e(S),{value:e(l).name,"onUpdate:value":a[0]||(a[0]=d=>e(l).name=d),placeholder:""},null,8,["value"])]),_:1}),o(e(f),{label:"Стоимость",path:"price"},{default:u(()=>[o(e(q),{value:e(l).price,"onUpdate:value":a[1]||(a[1]=d=>e(l).price=d),placeholder:"",precision:2},null,8,["value"])]),_:1}),o(e(f),{label:"Тип вывески",path:"type_id"},{default:u(()=>[o(e(I),{value:e(l).type_id,"onUpdate:value":a[2]||(a[2]=d=>e(l).type_id=d),remote:"",options:e(r)},null,8,["value","options"])]),_:1}),o(e(f),{label:"Ваш комментарий к заказу"},{default:u(()=>[o(e(S),{value:e(l).comment,"onUpdate:value":a[3]||(a[3]=d=>e(l).comment=d),type:"textarea",placeholder:""},null,8,["value"])]),_:1}),o(e(y),{type:"primary",onClick:a[4]||(a[4]=U(d=>k(),["prevent"]))},{default:u(()=>[C(" Изменить ")]),_:1})]),_:1},8,["rules","model"]))}}),A={class:"manager-orders-breaks"},de=N({__name:"PageManagerOrdersBreaks",setup(m){const p=D(),s=h(),n=w(!0),t=B({isShow:!1,id:NaN});x(async()=>{await s.request(),n.value=!1});async function r(i){p.confirm(async()=>{await s.stop(i)})}function _(i){t.id=i,t.isShow=!0}async function l(i){await s.restore(i)}function k(){t.isShow=!1}return(i,a)=>(c(),b("div",A,[o(e(V),{"title-placement":"left"},{default:u(()=>[C("Заказы в состоянии брака")]),_:1}),n.value?(c(),v(e(z),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(c(),v(j,{key:1,"table-data":e(s).orders,onChange:_,onStop:r,onRestore:l},null,8,["table-data"])),o(e(O),{show:t.isShow,"onUpdate:show":a[0]||(a[0]=d=>t.isShow=d)},{default:u(()=>[o(e(F),{style:{width:"600px"}},{default:u(()=>[o(P,{id:t.id,onDone:k},null,8,["id"])]),_:1})]),_:1},8,["show"])]))}});export{de as default};
