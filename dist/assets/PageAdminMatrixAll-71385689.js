import{d as b,c as h,a as l,o as d,y as m,t as M,v as S,i as p,k as N,m as w,f as x,g as _,w as g,F as k,l as z,b as y,N as C,_ as A}from"./index-4abd5337.js";import{N as D,a as B}from"./Skeleton-73bab458.js";import{a as q}from"./departments.store-8875aa8e.js";import{N as O}from"./InputNumber-af048807.js";import{N as P}from"./Divider-28823f40.js";import"./Suffix-81405455.js";import"./use-locale-8a81f948.js";import"./get-slot-1efb97e5.js";import"./Select-725ac10c.js";import"./cssr-c1e9b024.js";import"./Empty-529a0c43.js";import"./ChevronRight-9d44f072.js";import"./Forward-762501c8.js";import"./Input-16bae141.js";import"./Add-19412a86.js";const T=b({__name:"TableMatrix",props:{tableData:{},departmentColumns:{}},setup(r){const t=r,s=e();function e(){return[{title:"Тип вывески",key:"order_type.name",sorter:"default"},...t.departmentColumns,{title:"Сумма",key:"sum",sorter:"default"}]}return(i,a)=>(d(),h(l(D),{"single-line":!1,data:i.tableData,columns:l(s),bordered:!0},null,8,["data","columns"]))}});function U(){return{async getSerialized(){return(await m.get("/monetary-matrix/ser-to-table")).data},async getAll(){return(await m.get("/monetary-matrix/")).data},async bulkUpdate(r){return(await m.patch("/monetary-matrix/bulk-update",{matrices:r})).data}}}const v=U(),V=M(),$=S("matrix",{state:()=>({matrices:[],serializedMatrices:[]}),actions:{async requestSerialized(){this.serializedMatrices=await v.getSerialized()},async update(r){const t=[];for(let s=0;s<r.length;s++){const e=this.serializedMatrices[s],i=r[s];Object.keys(e).forEach(a=>{if(a!=="order_type"&&e[a].percent!==i[a].percent){const n=i[a];e[a].percent=i[a].percent,t.push({order_type_id:+n.order_type_id,department_id:+n.department_id,percent:n.percent})}})}t.length&&(await v.bulkUpdate(t),V.matrix.updated())},getCopy(){return JSON.parse(JSON.stringify(this.serializedMatrices))}}}),E={class:"admin-matrix-all"},F=b({__name:"PageAdminMatrixAll",setup(r){const t=$(),s=q(),e=p([]),i=p(!0),a=p([]);async function n(){await t.update(e.value)}return N(async()=>{await t.requestSerialized(),await s.request(),e.value=t.getCopy(),a.value=s.departments.map(o=>({title:o.name,key:`${o.id}.percent`,sorter:"default",render(c,f){return w(O,{value:c[o.id].percent,min:0,precision:2,max:100,onUpdateValue(u){u!=null&&(e.value[f][o.id].percent=u,console.log(u))}})}})),i.value=!1}),(o,c)=>(d(),x("div",E,[_(l(P),{"title-placement":"left"},{default:g(()=>[y("Матрица оплаты")]),_:1}),i.value?(d(),h(l(B),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(d(),x(k,{key:1},[_(T,{"table-data":e.value,"department-columns":a.value},null,8,["table-data","department-columns"]),_(l(C),{class:"admin-matrix-all__save-button",disabled:!e.value.length,type:"primary",onClick:c[0]||(c[0]=z(f=>n(),["prevent"]))},{default:g(()=>[y(" Сохранить ")]),_:1},8,["disabled"])],64))]))}});const ae=A(F,[["__scopeId","data-v-b69e2842"]]);export{ae as default};
