import{t as V,v as q,bO as W,i as F,j as I,k as M,d as x,o as l,c as v,w as a,g as c,a as o,b as m,N as b,_ as P,f as g,W as D,X as R,h as f,n as A,p as j,T as C,S as B,q as E,s as L,F as T,M as U}from"./index-16c8c699.js";import{u as z}from"./stage.service-03d9af21.js";import{u as X}from"./orders-break.store-7f33132c.js";import{N as G}from"./Select-17150864.js";import{N as H,a as J}from"./FormItem-83cee67d.js";import{N as K}from"./Space-2d4fd82a.js";import{N as O}from"./Empty-bc98c478.js";import{N as Q}from"./Divider-83f7740d.js";import"./order.service-7605b746.js";import"./orderTypes.store-7e5e6061.js";import"./use-locale-c61c26dc.js";import"./cssr-f76ec62b.js";import"./Suffix-0db10a3f.js";import"./get-slot-1efb97e5.js";const w=z(),p=V(),N=q("stages-work",{state:()=>({stages:[]}),actions:{async request(){this.stages=await w.getWork()},async ready(t){w.ready(t).then(()=>{p.stage.ready(),this.stages=this.stages.filter(e=>e.id!==t)}).catch(e=>{W.isAxiosError(e)?p.error.custom(e.response.data.message):p.error.error()})},async toBreak(t,e){w.toBreak(t,e).then(()=>{p.stage.break(),this.request()}).catch(r=>{W.isAxiosError(r)?p.error.custom(r.response.data.message):p.error.error()})},async unclaim(t){w.unclaim(t).then(()=>{p.stage.break(),this.stages=this.stages.filter(e=>e.id!==t)}).catch(e=>{W.isAxiosError(e)?p.error.custom(e.response.data.message):p.error.error()})},async setStop(t){const e=this.stages.find(i=>i.id===t);if(!e)return;await X().stop(e.order.id),this.stages=this.stages.filter(i=>i.id!==t)},async getPossibleBreak(t){return await w.getPossibleBreaks(t)}}});function Y(t){const e={break_name:{required:!0,message:"Выберите брак"}},r=F([]),i=I({break_name:"",break_id:null,department_id:null});return M(async()=>{const _=await N().getPossibleBreak(t);_.length&&_.forEach(n=>{r.value.push({label:n.name,value:n.id+" "+n.department_id})})}),{formValues:i,options:r,rules:e}}const Z=x({__name:"FormStageBreak",props:{id:{}},emits:["done"],setup(t,{emit:e}){const r=t,i=N(),{rules:d,options:_,formValues:n}=Y(r.id),S=F();function $(){var h;(h=S.value)==null||h.validate(async k=>{if(k)return;const s=n.break_name.split(" ");n.break_id=+s[0],n.department_id=+s[1],await i.toBreak(r.id,n),e("done")})}return(h,k)=>(l(),v(o(J),{ref_key:"stageBreakFormRef",ref:S,rules:o(d),model:o(n)},{default:a(()=>[c(o(H),{label:"Выберите брак",path:"break_name"},{default:a(()=>[c(o(G),{options:o(_),value:o(n).break_name,"onUpdate:value":k[0]||(k[0]=s=>o(n).break_name=s),placeholder:""},null,8,["options","value"])]),_:1}),c(o(b),{type:"error",onClick:$},{default:a(()=>[m("Отбраковать")]),_:1})]),_:1},8,["rules","model"]))}});const ee={},te=t=>(D("data-v-236e45bd"),t=t(),R(),t),se={class:"rollback",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},oe=te(()=>f("path",{d:"M9 13L5 9l4-4M5 9h11a4 4 0 0 1 0 8h-1",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),re=[oe];function ae(t,e){return l(),g("svg",se,re)}const ne=P(ee,[["render",ae],["__scopeId","data-v-236e45bd"]]),ie={class:"card-content"},de={key:0},le=f("strong",null,"Отдел - ",-1),ce={key:1},ue=f("strong",null,"Комментарий - ",-1),pe={key:2},me=f("strong",null,"Брак - ",-1),_e=x({__name:"CardStageWork",props:{stage:{}},setup(t){const e=t,{confirm:r}=A(),i=N(),d=I({isShow:!1,id:NaN}),_=j(()=>e.stage.break);function n(s){d.isShow=!0,d.id=s}function S(s){r(async()=>{await i.setStop(s)})}function $(){d.isShow=!1}function h(s){r(async()=>{await i.ready(s)})}function k(s){r(async()=>{await i.unclaim(s)})}return(s,u)=>(l(),v(o(E),{title:`${s.stage.order.name} ${s.stage.order.code}`},{"header-extra":a(()=>[c(ne,{onClick:u[0]||(u[0]=y=>k(s.stage.id))})]),action:a(()=>[c(o(K),{vertical:""},{default:a(()=>[c(o(b),{onClick:u[1]||(u[1]=y=>h(s.stage.id)),style:{width:"100%"},type:"success"},{default:a(()=>[m("Готово")]),_:1}),_.value?(l(),v(o(b),{key:0,onClick:u[2]||(u[2]=y=>S(s.stage.id)),style:{width:"100%"},type:"error"},{default:a(()=>[m("Снять с производства")]),_:1})):(l(),v(o(b),{key:1,onClick:u[3]||(u[3]=y=>n(s.stage.id)),style:{width:"100%"},type:"error",ghost:""},{default:a(()=>[m("Отметить брак")]),_:1}))]),_:1})]),default:a(()=>[f("div",ie,[s.stage.department?(l(),g("p",de,[le,m(" "+C(s.stage.department.name),1)])):B("",!0),s.stage.order.comment?(l(),g("p",ce,[ue,m(" "+C(s.stage.order.comment),1)])):B("",!0),_.value?(l(),g("p",pe,[me,m(" "+C(s.stage.break.name),1)])):B("",!0)]),c(o(L),{show:d.isShow,"onUpdate:show":u[4]||(u[4]=y=>d.isShow=y)},{default:a(()=>[c(o(E),{style:{width:"600px"}},{default:a(()=>[c(Z,{id:d.id,onDone:$},null,8,["id"])]),_:1})]),_:1},8,["show"])]),_:1},8,["title"]))}}),ge={class:"employee-work"},ke={key:0,class:"employee-work__empty"},fe={class:"employee-work__cards"},he=x({__name:"PageEmployeeWork",setup(t){const e=N();return M(async()=>{await e.request()}),(r,i)=>(l(),g("div",ge,[c(o(Q),null,{default:a(()=>[m("Текущие задачи")]),_:1}),o(e).stages.length?B("",!0):(l(),g("div",ke,[c(o(O),{size:"huge",description:"У вас нет ни одной задачи"},{extra:a(()=>[m("Пусто")]),_:1})])),f("div",fe,[(l(!0),g(T,null,U(o(e).stages,d=>(l(),v(_e,{key:d.id,stage:d},null,8,["stage"]))),128))])]))}});const Me=P(he,[["__scopeId","data-v-b4f3d25b"]]);export{Me as default};
