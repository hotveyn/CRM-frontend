import{a as M,N as R}from"./Select-8ae686c1.js";import{N as B,a as E}from"./Skeleton-a17865c3.js";import{d as x,m as _,f as D,g as r,a as e,N as k,o as N,i as U,j as T,k as W,c as b,w as i,b as F,l as V,n as $,p as C,q,s as z}from"./index-62384645.js";import{u as S}from"./users.store-ca04dd30.js";import{a as I}from"./departments.store-3fc2218e.js";import{N as y}from"./Input-c95d618b.js";import{N as h,a as O}from"./FormItem-9db69890.js";import{N as j}from"./DatePicker-e6b61f2e.js";import{N as A}from"./Divider-bdda2be5.js";import"./use-locale-a4cb9846.js";import"./cssr-1cbf0123.js";import"./Suffix-86caeb40.js";import"./get-806e042e.js";import"./Empty-6144791c.js";import"./get-slot-1efb97e5.js";import"./ChevronRight-7e3f7794.js";import"./Forward-d200b360.js";const P={class:"table-user"},L=x({__name:"TableUser",props:{tableData:{},filters:{}},emits:["fire","change"],setup(v,{emit:m}){const u=v,s=d({fire:n=>{m("fire",n)},change:n=>{m("change",n)}});function d(n){return[{title:"Номер",key:"code",sorter:"default"},{title:"ФИО",key:"name",sorter:"default"},{title:"Роль",key:"role",sorter:"default"},{title:"Отделы",key:"departments",render(t){return t.departments.map(p=>_(M,{style:{marginRight:"6px"},type:"info",bordered:!1},{default:()=>p}))},filterOptions:u.filters,filter(t,p){return p.departments.indexOf(t)!==-1}},{title:"Действия",key:"actions",render(t){return[_(k,{type:"default",size:"small",style:{marginRight:"6px",marginTop:"6px",width:"100%",maxWidth:"100px"},onClick:()=>n.change(t.id)},{default:()=>"Изменить"}),_(k,{type:"error",size:"small",style:{marginRight:"6px",marginTop:"6px",width:"100%",maxWidth:"100px"},onClick:()=>n.fire(t.id)},{default:()=>"Уволить"})]}}]}return(n,t)=>(N(),D("div",P,[r(e(B),{data:n.tableData,"single-line":!1,columns:e(s),pagination:{pageSize:30},bordered:!0},null,8,["data","columns"])]))}});function G(v){const m={},u=U([]),s=T({code:"",lastName:"",firstName:"",patronymicName:"",startWorkDate:"2004-07-13",departments:null,login:"",password:""});return W(async()=>{var p;const d=S(),n=I(),t=d.findById(v);s.code=t.code,s.lastName=t.last_name,s.firstName=t.first_name,s.patronymicName=t.patronymic_name,s.startWorkDate=t.start_work_date,s.departments=[],s.login=t.login,(p=t.departments)==null||p.forEach(f=>{var c;(c=s.departments)==null||c.push(f.id)}),await n.request(),n.departments.forEach(f=>{u.value.push({label:f.name,value:f.id})})}),{rules:m,formValues:s,options:u}}const H=x({__name:"FormUserUpdate",props:{userId:{}},emits:["changed"],setup(v,{emit:m}){const u=v,s=U(),d=S(),{rules:n,formValues:t,options:p}=G(u.userId);async function f(){var c;(c=s.value)==null||c.validate(async a=>{a||(await d.update(u.userId,t),m("changed"))})}return(c,a)=>(N(),b(e(O),{ref_key:"userUpdateRef",ref:s,model:e(t),rules:e(n),class:"reg-form"},{default:i(()=>[r(e(h),{label:"Номер сотрудника",path:"code"},{default:i(()=>[r(e(y),{value:e(t).code,"onUpdate:value":a[0]||(a[0]=o=>e(t).code=o),placeholder:"Сгенерируется сам, если оставите незаполненным"},null,8,["value"])]),_:1}),r(e(h),{label:"Фамилия",path:"lastName"},{default:i(()=>[r(e(y),{value:e(t).lastName,"onUpdate:value":a[1]||(a[1]=o=>e(t).lastName=o),placeholder:"Иванов"},null,8,["value"])]),_:1}),r(e(h),{label:"Имя",path:"firstName"},{default:i(()=>[r(e(y),{value:e(t).firstName,"onUpdate:value":a[2]||(a[2]=o=>e(t).firstName=o),placeholder:"Иван"},null,8,["value"])]),_:1}),r(e(h),{label:"Отчество",path:"patronymicName"},{default:i(()=>[r(e(y),{value:e(t).patronymicName,"onUpdate:value":a[3]||(a[3]=o=>e(t).patronymicName=o),placeholder:"Иванович"},null,8,["value"])]),_:1}),r(e(h),{label:"Дата устройства на работу",path:"startWorkDate"},{default:i(()=>[r(e(j),{"value-format":"yyyy-MM-dd","formatted-value":e(t).startWorkDate,"onUpdate:formattedValue":a[4]||(a[4]=o=>e(t).startWorkDate=o),style:{width:"100%"},placeholder:"",type:"date"},null,8,["formatted-value"])]),_:1}),r(e(h),{label:"Департаменты",path:"departments"},{default:i(()=>[r(e(R),{value:e(t).departments,"onUpdate:value":a[5]||(a[5]=o=>e(t).departments=o),placeholder:"Минимум 1",multiple:"",remote:"",options:e(p)},null,8,["value","options"])]),_:1}),r(e(h),{label:"Логин",path:"login"},{default:i(()=>[r(e(y),{value:e(t).login,"onUpdate:value":a[6]||(a[6]=o=>e(t).login=o),placeholder:""},null,8,["value"])]),_:1}),r(e(h),{label:"Пароль",path:"password"},{default:i(()=>[r(e(y),{value:e(t).password,"onUpdate:value":a[7]||(a[7]=o=>e(t).password=o),type:"password",placeholder:"Текущий пароль захеширован и не покажется","show-password-on":"click"},null,8,["value"])]),_:1}),r(e(k),{class:"login-form__button",type:"primary",onClick:a[8]||(a[8]=V(o=>f(),["prevent"]))},{default:i(()=>[F(" Сохранить ")]),_:1})]),_:1},8,["model","rules"]))}}),J={class:"admin-users-all"},me=x({__name:"PageAdminEmployeesAll",setup(v){const{confirm:m}=$(),u=I(),s=S(),d=T({isShow:!1,id:NaN}),n=U(!0),t=C(()=>s.users.map(l=>{const g=[];return l.departments&&l.departments.forEach(w=>{g.push(w.name)}),{id:l.id,name:[l.last_name,l.first_name,l.patronymic_name].join(" "),role:p(l.role),code:l.code,departments:g}}));function p(l){switch(l){case"manager":return"Менеджер";case"employee":return"Работник";case"storage":return"Кладовщик";case"admin":return"Админ"}}const f=C(()=>u.departments.map(l=>({label:l.name,value:l.name})));function c(l){m(async()=>{await s.fire(l)})}function a(l){d.id=l,d.isShow=!0}function o(){d.isShow=!1}return W(async()=>{await s.request(),await u.request(),n.value=!1}),(l,g)=>(N(),D("div",J,[r(e(A),{"title-placement":"left"},{default:i(()=>[F("Действующие сотрудники")]),_:1}),n.value?(N(),b(e(E),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(N(),b(L,{key:1,"pagination-behavior-on-filter":"first",onFire:c,onChange:a,"table-data":t.value,filters:f.value},null,8,["table-data","filters"])),r(e(z),{show:d.isShow,"onUpdate:show":g[1]||(g[1]=w=>d.isShow=w)},{default:i(()=>[r(e(q),{style:{width:"600px"}},{default:i(()=>[r(H,{"user-id":d.id,onChanged:g[0]||(g[0]=w=>o())},null,8,["user-id"])]),_:1})]),_:1},8,["show"])]))}});export{me as default};
