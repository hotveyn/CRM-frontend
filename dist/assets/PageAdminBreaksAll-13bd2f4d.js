import{d as k,c as _,a as e,o as f,m as b,N as g,i as v,j as S,k as w,w as d,g as s,b as C,l as x,n as B,f as D,q as F,s as U}from"./index-19bdbec0.js";import{N as q,a as R}from"./Skeleton-daacf131.js";import{u as N}from"./breaks.store-94a49af8.js";import{a as z}from"./departments.store-be89531f.js";import{N as M}from"./Input-96dcc6c7.js";import{N as y,a as V}from"./FormItem-359e477c.js";import{N as I}from"./Select-34ee482a.js";import{N as T}from"./Divider-c7a65899.js";import"./get-cb4eec91.js";import"./use-locale-b60157c8.js";import"./get-slot-1efb97e5.js";import"./Suffix-e9335d58.js";import"./ChevronRight-bb8cf647.js";import"./Forward-23539524.js";import"./Empty-101753d0.js";import"./cssr-95c10af3.js";const $=k({__name:"TableBreak",props:{tableData:{}},emits:["remove","change"],setup(c,{emit:i}){const r=a({change:t=>{i("change",t)},remove:t=>{i("remove",t)}});function a(t){return[{title:"Название",key:"name",sorter:"default"},{title:"Отвечающий отдел",key:"department.name",sorter:"default"},{title:"Действия",key:"actions",render(l){return[b(g,{type:"default",size:"small",style:{marginRight:"6px"},onClick:()=>t.change(l.id)},{default:()=>"Изменить"}),b(g,{type:"error",size:"small",style:{marginRight:"6px"},onClick:()=>t.remove(l.id)},{default:()=>"Удалить"})]}}]}return(t,l)=>(f(),_(e(q),{"single-line":!1,data:t.tableData,columns:e(r),pagination:{pageSize:30},bordered:!0},null,8,["data","columns"]))}});function A(c){const i={name:{required:!0,message:"Введите название брака"},department_id:{required:!0,message:"Выбирите отдел ответственный за этот брак"}},r=v([]),a=S({name:"",department_id:null});return w(async()=>{const t=z();await t.request(),t.departments.forEach(o=>{r.value.push({label:o.name,value:o.id})});const m=N().findById(c);a.name=m==null?void 0:m.name,a.department_id=Number(m.department_id)}),{rules:i,formValues:a,options:r}}const E=k({__name:"FormBreakUpdate",props:{id:{}},emits:["changed"],setup(c,{emit:i}){const r=c,a=N(),t=v(),{rules:l,options:m,formValues:o}=A(r.id);function u(){var p;(p=t.value)==null||p.validate(async n=>{n||(await a.update(r.id,o),i("changed"))})}return(p,n)=>(f(),_(e(V),{ref_key:"breakCreateFormRef",ref:t,rules:e(l),model:e(o),class:"break-create-form"},{default:d(()=>[s(e(y),{label:"Название брака",path:"name"},{default:d(()=>[s(e(M),{value:e(o).name,"onUpdate:value":n[0]||(n[0]=h=>e(o).name=h),placeholder:""},null,8,["value"])]),_:1}),s(e(y),{label:"Ответственный отдел",path:"department_id"},{default:d(()=>[s(e(I),{value:e(o).department_id,"onUpdate:value":n[1]||(n[1]=h=>e(o).department_id=h),placeholder:"",options:e(m),remote:""},null,8,["value","options"])]),_:1}),s(e(g),{type:"primary",onClick:n[2]||(n[2]=x(h=>u(),["prevent"]))},{default:d(()=>[C(" Поменять ")]),_:1})]),_:1},8,["rules","model"]))}}),j={class:"admin-departments-all"},oe=k({__name:"PageAdminBreaksAll",setup(c){const i=B(),r=N(),a=S({isShow:!1,id:NaN}),t=v(!0);function l(u){a.isShow=!0,a.id=u}function m(){a.isShow=!1}function o(u){i.confirm(()=>{r.remove(u)})}return w(async()=>{await r.request(),t.value=!1}),(u,p)=>(f(),D("div",j,[s(e(T),{"title-placement":"left"},{default:d(()=>[C("Все виды браков")]),_:1}),t.value?(f(),_(e(R),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(f(),_($,{key:1,"table-data":e(r).breaks,onChange:l,onRemove:o},null,8,["table-data"])),s(e(U),{show:a.isShow,"onUpdate:show":p[0]||(p[0]=n=>a.isShow=n)},{default:d(()=>[s(e(F),{style:{width:"600px"}},{default:d(()=>[s(E,{id:a.id,onChanged:m},null,8,["id"])]),_:1})]),_:1},8,["show"])]))}});export{oe as default};
