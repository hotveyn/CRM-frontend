import{d as S,f as T,g as a,a as e,o as w,m as b,N as k,i as y,k as I,c as N,w as l,h as $,b as W,l as F,_ as B,j as g,n as M,q as C,s as U}from"./index-62384645.js";import{N as O,a as z}from"./Skeleton-a17865c3.js";import{u as x}from"./orders-new.store-1c920618.js";import{a as E}from"./departments.store-3fc2218e.js";import{N as P}from"./DynamicInput-d773a7fd.js";import{N as h,a as D}from"./FormItem-9db69890.js";import{N as R}from"./Select-8ae686c1.js";import{N as q}from"./InputNumber-17324f83.js";import{u as j}from"./orderTypes.store-cd2a7c53.js";import{N as V}from"./Input-c95d618b.js";import{N as L}from"./Divider-bdda2be5.js";import"./get-806e042e.js";import"./use-locale-a4cb9846.js";import"./get-slot-1efb97e5.js";import"./Suffix-86caeb40.js";import"./ChevronRight-7e3f7794.js";import"./Forward-d200b360.js";import"./Empty-6144791c.js";import"./order.service-15093fdc.js";import"./Add-27b36ee1.js";import"./cssr-1cbf0123.js";const A={class:"table-orders-new"},G=S({__name:"TableOrdersNew",props:{tableData:{}},emits:["change","remove","toWork"],setup(c,{emit:u}){const d=i({change:o=>u("change",o),remove:o=>u("remove",o),toWork:o=>u("toWork",o)});function i(o){return[{title:"Код",key:"code",sorter:"default"},{title:"Название",key:"name",sorter:"default"},{title:"Дата начала",key:"date_start",sorter:"default"},{title:"Дата сдачи",key:"date_end",sorter:"default"},{title:"Тип",key:"type.name",sorter:"default"},{title:"Стоимость",key:"price",sorter:"default"},{title:"Комментарий",key:"comment",sorter:"default"},{title:"Действия",key:"actions",width:110,render(t){return[b(k,{type:"default",size:"small",style:{marginRight:"6px",width:"100%",maxWidth:"100px"},onClick:()=>o.change(t.id)},{default:()=>"Изменить"}),b(k,{type:"primary",size:"small",style:{marginRight:"6px",marginTop:"6px",width:"100%",maxWidth:"100px"},onClick:()=>o.toWork(t.id)},{default:()=>"В работу"}),b(k,{type:"error",size:"small",style:{marginRight:"6px",marginTop:"6px",width:"100%",maxWidth:"100px"},onClick:()=>o.remove(t.id)},{default:()=>"Удалить"})]}}]}return(o,t)=>(w(),T("div",A,[a(e(O),{"single-line":!1,data:o.tableData,columns:e(d),pagination:{pageSize:30},bordered:!0},null,8,["data","columns"])]))}});function H(){const c={trigger:"input",validator(t,s){return s?!0:new Error("Сделайте выбор")}},u=y([]),d=y([{department_id:void 0,percent:void 0}]),i=y({dynamicInputValue:[{department_id:void 0,percent:void 0}]});I(async()=>{const t=E();await t.request(),t.departments.forEach(s=>{u.value.push({label:s.name,value:s.id})})});function o(){return{department_id:void 0,percent:void 0}}return{model:i,dynamicInputRule:c,formValues:d,options:u,onCreateInp:o}}const J={class:"dynamic-input"},K=S({__name:"FormToWork",props:{id:{}},emits:["done"],setup(c,{emit:u}){const d=c,i=x(),{dynamicInputRule:o,model:t,onCreateInp:s,options:p}=H(),v=y();function f(){var n;(n=v.value)==null||n.validate(async r=>{r||(await i.toWork(d.id,t.value.dynamicInputValue),u("done"))})}return(n,r)=>(w(),N(e(D),{ref_key:"toWorkFormRef",ref:v,model:e(t)},{default:l(()=>[a(e(P),{min:1,value:e(t).dynamicInputValue,"onUpdate:value":r[0]||(r[0]=m=>e(t).dynamicInputValue=m),"on-create":e(s),"show-sort-button":""},{default:l(({index:m})=>[$("div",J,[a(e(h),{"show-label":!1,"ignore-path-change":"",path:`dynamicInputValue[${m}].department_id`,rule:e(o)},{default:l(()=>[a(e(R),{value:e(t).dynamicInputValue[m].department_id,"onUpdate:value":_=>e(t).dynamicInputValue[m].department_id=_,placeholder:"Выберите отдел",remote:"",options:e(p)},null,8,["value","onUpdate:value","options"])]),_:2},1032,["path","rule"]),a(e(h),{"show-label":!1},{default:l(()=>[a(e(q),{value:e(t).dynamicInputValue[m].percent,"onUpdate:value":_=>e(t).dynamicInputValue[m].percent=_,min:0,max:100,precision:2,placeholder:"Проценты за работу",style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1024)])]),_:1},8,["value","on-create"]),a(e(k),{type:"primary",onClick:F(f,["prevent"])},{default:l(()=>[W("Отправить в работу")]),_:1},8,["onClick"])]),_:1},8,["model"]))}});const Q=B(K,[["__scopeId","data-v-fcad55af"]]),X=x();function Y(c){const u={name:{required:!0,message:"Введите название заказа"},type:{required:!0,message:"Выбирете тип заказа"},price:{required:!0,message:"Введите цену вывески"},type_id:{required:!0,message:"Выберите тип вывески"}},d=y([]),i=g({name:"",type_id:void 0,price:NaN,comment:""}),o=g({possible:!0,why:""});return I(async()=>{const t=j();d.value=await t.getForSelect();const s=X.findById(c);s&&(i.name=s.name,i.price=s.price,i.comment=s.comment,s.type&&(i.type_id=s.type.id))}),{rules:u,options:d,formValues:i,isPossible:o}}const Z=S({__name:"FormOrderNewUpdate",props:{id:{}},emits:["done"],setup(c,{emit:u}){const d=c,i=x(),o=y(),{options:t,rules:s,formValues:p}=Y(d.id);function v(){var f;(f=o.value)==null||f.validate(async n=>{n||(await i.update(d.id,p),u("done"))})}return(f,n)=>(w(),N(e(D),{ref_key:"orderUpdateFormRef",ref:o,rules:e(s),model:e(p)},{default:l(()=>[a(e(h),{label:"Название заказа",path:"name"},{default:l(()=>[a(e(V),{value:e(p).name,"onUpdate:value":n[0]||(n[0]=r=>e(p).name=r),placeholder:""},null,8,["value"])]),_:1}),a(e(h),{label:"Стоимость",path:"price"},{default:l(()=>[a(e(q),{value:e(p).price,"onUpdate:value":n[1]||(n[1]=r=>e(p).price=r),placeholder:"",precision:2},null,8,["value"])]),_:1}),a(e(h),{label:"Тип вывески",path:"type_id"},{default:l(()=>[a(e(R),{value:e(p).type_id,"onUpdate:value":n[2]||(n[2]=r=>e(p).type_id=r),remote:"",options:e(t)},null,8,["value","options"])]),_:1}),a(e(h),{label:"Ваш комментарий к заказу"},{default:l(()=>[a(e(V),{value:e(p).comment,"onUpdate:value":n[3]||(n[3]=r=>e(p).comment=r),type:"textarea",placeholder:""},null,8,["value"])]),_:1}),a(e(k),{type:"primary",onClick:n[4]||(n[4]=F(r=>v(),["prevent"]))},{default:l(()=>[W(" Изменить ")]),_:1})]),_:1},8,["rules","model"]))}}),ee={class:"manager-orders-new"},ge=S({__name:"PageManagerOrdersNew",setup(c){const u=M(),d=x(),i=y(!0),o=g({isShow:!1,id:NaN}),t=g({isShow:!1,id:NaN});async function s(r){u.confirm(()=>{d.remove(r)})}async function p(r){t.isShow=!0,t.id=r}function v(r){o.isShow=!0,o.id=r}function f(){o.isShow=!1}function n(){t.isShow=!1}return I(async()=>{await d.request(),i.value=!1}),(r,m)=>(w(),T("div",ee,[a(e(L),{"title-placement":"left"},{default:l(()=>[W("Неовые необработанные заказы")]),_:1}),i.value?(w(),N(e(z),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(w(),N(G,{key:1,"table-data":e(d).orders,onRemove:s,onChange:p,onToWork:v},null,8,["table-data"])),a(e(U),{show:o.isShow,"onUpdate:show":m[0]||(m[0]=_=>o.isShow=_)},{default:l(()=>[a(e(C),{style:{width:"800px"}},{default:l(()=>[a(Q,{id:o.id,onDone:f},null,8,["id"])]),_:1})]),_:1},8,["show"]),a(e(U),{show:t.isShow,"onUpdate:show":m[1]||(m[1]=_=>t.isShow=_)},{default:l(()=>[a(e(C),{style:{width:"600px"}},{default:l(()=>[a(Z,{id:t.id,onDone:n},null,8,["id"])]),_:1})]),_:1},8,["show"])]))}});export{ge as default};
