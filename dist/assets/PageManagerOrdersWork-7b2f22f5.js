import{d as S,f as D,g as r,a as e,o as y,m as x,N as b,i as g,j as I,k as F,c as k,w as s,bM as R,h as B,S as M,b as T,l as V,_ as $,n as z,q as E,s as P}from"./index-62384645.js";import{N as j,a as L}from"./Skeleton-a17865c3.js";import{u as U}from"./orders-work.store-030318f4.js";import{a as A}from"./departments.store-3fc2218e.js";import{u as G}from"./orderTypes.store-cd2a7c53.js";import{N as C}from"./Input-c95d618b.js";import{N as v,a as H}from"./FormItem-9db69890.js";import{N as O}from"./InputNumber-17324f83.js";import{N as W}from"./Select-8ae686c1.js";import{N as J}from"./Switch-bfa0d2e8.js";import{N as K}from"./DynamicInput-d773a7fd.js";import{N as Q}from"./Divider-bdda2be5.js";import"./get-806e042e.js";import"./use-locale-a4cb9846.js";import"./get-slot-1efb97e5.js";import"./Suffix-86caeb40.js";import"./ChevronRight-7e3f7794.js";import"./Forward-d200b360.js";import"./Empty-6144791c.js";import"./order.service-15093fdc.js";import"./Add-27b36ee1.js";import"./cssr-1cbf0123.js";const X={class:"table-orders-work"},Y=S({__name:"TableOrdersWork",props:{tableData:{}},emits:["change","deleteOne"],setup(h,{emit:i}){const f=u({change:a=>i("change",a),deleteOne:a=>i("deleteOne",a)});function u(a){return[{title:"Код",key:"code",minWidth:110,sorter:"default"},{title:"Название",key:"name",sorter:"default"},{title:"Дата начала",key:"date_start",sorter:"default"},{title:"Дата сдачи",key:"date_end",sorter:"default"},{title:"Тип",key:"type.name",sorter:"default"},{title:"Стоимость",key:"price",sorter:"default"},{title:"Текущий этап произодства",key:"current_department",sorter:"default"},{title:"Текущий исполнитель",key:"current_user",sorter:"default"},{title:"Комментарий",key:"comment",sorter:"default"},{title:"Действия",key:"actions",width:110,render(m){return[x(b,{type:"default",size:"small",style:{marginRight:"6px",width:"100%",maxWidth:"100px"},onClick:()=>a.change(m.id)},{default:()=>"Изменить"}),x(b,{type:"error",size:"small",style:{marginRight:"6px",marginTop:"6px",width:"100%",maxWidth:"100px"},onClick:()=>a.deleteOne(m.id)},{default:()=>"Удалить"})]}}]}return(a,m)=>(y(),D("div",X,[r(e(j),{"single-line":!1,data:a.tableData,columns:e(f),pagination:{pageSize:30},bordered:!0},null,8,["data","columns"])]))}}),Z=U();function ee(h){const i={name:{required:!0,message:"Введите название заказа"},type:{required:!0,message:"Выбирете тип заказа"},price:{required:!0,message:"Введите длину неона"}},f={trigger:"input",validator(t,l){return console.log(l),l?!0:new Error("Сделайте выбор")}},u=g([]),a=g([]),m=g(!1),p=I({name:"",type_id:void 0,price:0,comment:"",departments:[{department_id:void 0,percent:void 0}]});F(async()=>{const t=G(),l=A();await Promise.all([t.request(),l.request()]),a.value=t.selected,console.log(a.value),console.log(l.departments);const d=Z.findById(h);d&&(p.name=d.name,p.price=d.price,p.comment=d.comment,d.type&&(p.type_id=d.type.id),p.departments=d.order_stages.map(_=>({department_id:+_.department_id,percent:_.percent}))),l.departments.forEach(_=>{u.value.push({label:_.name,value:_.id})})});function c(){return{department_id:void 0,percent:void 0}}return{rules:i,options:u,isDepartmentsChange:m,formValues:p,dynamicInputRule:f,optionsType:a,onCreateInp:c}}const te={class:"dynamic-input"},ae=S({__name:"FormOrderWorkUpdate",props:{id:{}},emits:["done"],setup(h,{emit:i}){const f=h,u=U(),a=g(),{options:m,rules:p,isDepartmentsChange:c,formValues:t,optionsType:l,onCreateInp:d,dynamicInputRule:_}=ee(f.id);function q(){var N;(N=a.value)==null||N.validate(async n=>{n||(c.value||delete t.departments,await u.update(f.id,t),i("done"))})}return(N,n)=>(y(),k(e(H),{ref_key:"orderUpdateFormRef",ref:a,rules:e(p),model:e(t)},{default:s(()=>[r(e(v),{label:"Название заказа",path:"name"},{default:s(()=>[r(e(C),{value:e(t).name,"onUpdate:value":n[0]||(n[0]=o=>e(t).name=o),placeholder:""},null,8,["value"])]),_:1}),r(e(v),{label:"Стоимость",path:"price"},{default:s(()=>[r(e(O),{value:e(t).price,"onUpdate:value":n[1]||(n[1]=o=>e(t).price=o),placeholder:"",precision:2},null,8,["value"])]),_:1}),r(e(v),{label:"Тип вывески",path:"type_id"},{default:s(()=>[r(e(W),{value:e(t).type_id,"onUpdate:value":n[2]||(n[2]=o=>e(t).type_id=o),remote:"",options:e(l)},null,8,["value","options"])]),_:1}),r(e(v),{label:"Ваш комментарий к заказу"},{default:s(()=>[r(e(C),{value:e(t).comment,"onUpdate:value":n[3]||(n[3]=o=>e(t).comment=o),type:"textarea",placeholder:""},null,8,["value"])]),_:1}),r(e(v),{label:"Поменять ли этапы работы? Если вы их поменяете процесс работы начнётся занова с первого этапа!"},{default:s(()=>[r(e(J),{value:e(c),"onUpdate:value":n[4]||(n[4]=o=>R(c)?c.value=o:null)},null,8,["value"])]),_:1}),e(c)?(y(),k(e(K),{key:0,min:1,value:e(t).departments,"onUpdate:value":n[5]||(n[5]=o=>e(t).departments=o),"on-create":e(d),"show-sort-button":""},{default:s(({index:o})=>[B("div",te,[r(e(v),{"show-label":!1,"ignore-path-change":"",path:`departments[${o}].department_id`,rule:e(_)},{default:s(()=>[r(e(W),{value:e(t).departments[o].department_id,"onUpdate:value":w=>e(t).departments[o].department_id=w,placeholder:"Выберите отдел",remote:"",options:e(m)},null,8,["value","onUpdate:value","options"])]),_:2},1032,["path","rule"]),r(e(v),{"show-label":!1},{default:s(()=>[r(e(O),{value:e(t).departments[o].percent,"onUpdate:value":w=>e(t).departments[o].percent=w,min:0,max:100,precision:2,placeholder:"Проценты за работу",style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1024)])]),_:1},8,["value","on-create"])):M("",!0),r(e(b),{type:"primary",onClick:n[6]||(n[6]=V(o=>q(),["prevent"]))},{default:s(()=>[T(" Изменить ")]),_:1})]),_:1},8,["rules","model"]))}});const re=$(ae,[["__scopeId","data-v-7c7f7e0a"]]),oe={class:"manager-orders-work"},Ce=S({__name:"PageManagerOrdersWork",setup(h){const i=U(),f=z(),u=g(!0),a=I({isShow:!1,id:NaN});function m(t){a.id=t,a.isShow=!0}async function p(t){f.confirm(async()=>{await i.deleteOne(t)})}function c(){a.isShow=!1}return F(async()=>{await i.request(),u.value=!1}),(t,l)=>(y(),D("div",oe,[r(e(Q),{"title-placement":"left"},{default:s(()=>[T("Заказы в производстве")]),_:1}),u.value?(y(),k(e(L),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(y(),k(Y,{key:1,onChange:m,onDeleteOne:p,"table-data":e(i).orders},null,8,["table-data"])),r(e(P),{show:a.isShow,"onUpdate:show":l[0]||(l[0]=d=>a.isShow=d)},{default:s(()=>[r(e(E),{style:{width:"600px"}},{default:s(()=>[r(re,{id:a.id,onDone:c},null,8,["id"])]),_:1})]),_:1},8,["show"])]))}});export{Ce as default};
