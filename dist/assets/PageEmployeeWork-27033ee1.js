import{t as q,v as D,bO as E,i as $,j as P,k as V,d as C,o as u,c as f,w as r,g as m,a as t,b as c,N as B,n as M,p as x,T as v,h as y,f as _,S as b,q as F,s as A,F as I,M as R,_ as T}from"./index-febb9171.js";import{u as U}from"./stage.service-2d024ad4.js";import{u as j}from"./orders-break.store-2f663c5b.js";import{N as z}from"./Select-479ae167.js";import{N as L,a as G}from"./FormItem-c4985c2b.js";import{N as H}from"./Space-222912f8.js";import{N as J}from"./Empty-0a7cc83a.js";import{N as K}from"./Divider-1a5ba554.js";import"./order.service-af9caac5.js";import"./orderTypes.store-ef57b4c4.js";import"./use-locale-07b54378.js";import"./cssr-ece96bea.js";import"./Suffix-04a49060.js";import"./get-slot-1efb97e5.js";const w=U(),g=q(),N=D("stages-work",{state:()=>({stages:[]}),actions:{async request(){this.stages=await w.getWork()},async ready(a){w.ready(a).then(()=>{g.stage.ready(),this.stages=this.stages.filter(s=>s.id!==a)}).catch(s=>{E.isAxiosError(s)?g.error.custom(s.response.data.message):g.error.error()})},async toBreak(a,s){w.toBreak(a,s).then(()=>{g.stage.break(),this.request()}).catch(o=>{E.isAxiosError(o)?g.error.custom(o.response.data.message):g.error.error()})},async setStop(a){const s=this.stages.find(l=>l.id===a);if(!s)return;await j().stop(s.order.id),this.stages=this.stages.filter(l=>l.id!==a)},async getPossibleBreak(a){return await w.getPossibleBreaks(a)}}});function O(a){const s={break_name:{required:!0,message:"Выберите брак"}},o=$([]),l=P({break_name:"",break_id:null,department_id:null});return V(async()=>{const p=await N().getPossibleBreak(a);p.length&&p.forEach(n=>{o.value.push({label:n.name,value:n.id+" "+n.department_id})})}),{formValues:l,options:o,rules:s}}const Q=C({__name:"FormStageBreak",props:{id:{}},emits:["done"],setup(a,{emit:s}){const o=a,l=N(),{rules:d,options:p,formValues:n}=O(o.id),h=$();function W(){var k;(k=h.value)==null||k.validate(async e=>{if(e)return;const i=n.break_name.split(" ");n.break_id=+i[0],n.department_id=+i[1],await l.toBreak(o.id,n),s("done")})}return(k,e)=>(u(),f(t(G),{ref_key:"stageBreakFormRef",ref:h,rules:t(d),model:t(n)},{default:r(()=>[m(t(L),{label:"Выберите брак",path:"break_name"},{default:r(()=>[m(t(z),{options:t(p),value:t(n).break_name,"onUpdate:value":e[0]||(e[0]=i=>t(n).break_name=i),placeholder:""},null,8,["options","value"])]),_:1}),m(t(B),{type:"error",onClick:W},{default:r(()=>[c("Отбраковать")]),_:1})]),_:1},8,["rules","model"]))}}),X={class:"card-content"},Y={key:0},Z=y("strong",null,"Отдел - ",-1),ee={key:1},te=y("strong",null,"Комментарий - ",-1),se={key:2},ae=y("strong",null,"Брак - ",-1),re=C({__name:"CardStageWork",props:{stage:{}},setup(a){const s=a,{confirm:o}=M(),l=N(),d=P({isShow:!1,id:NaN}),p=x(()=>s.stage.break);function n(e){d.isShow=!0,d.id=e}function h(e){o(async()=>{await l.setStop(e)})}function W(){d.isShow=!1}function k(e){o(async()=>{await l.ready(e)})}return(e,i)=>(u(),f(t(F),{title:e.stage.order.name},{"header-extra":r(()=>[c(v(e.stage.order.code),1)]),action:r(()=>[m(t(H),{vertical:""},{default:r(()=>[m(t(B),{onClick:i[0]||(i[0]=S=>k(e.stage.id)),style:{width:"100%"},type:"success"},{default:r(()=>[c("Готово")]),_:1}),p.value?(u(),f(t(B),{key:0,onClick:i[1]||(i[1]=S=>h(e.stage.id)),style:{width:"100%"},type:"error"},{default:r(()=>[c("Снять с производства")]),_:1})):(u(),f(t(B),{key:1,onClick:i[2]||(i[2]=S=>n(e.stage.id)),style:{width:"100%"},type:"error",ghost:""},{default:r(()=>[c("Отметить брак")]),_:1}))]),_:1})]),default:r(()=>[y("div",X,[e.stage.department?(u(),_("p",Y,[Z,c(" "+v(e.stage.department.name),1)])):b("",!0),e.stage.order.comment?(u(),_("p",ee,[te,c(" "+v(e.stage.order.comment),1)])):b("",!0),p.value?(u(),_("p",se,[ae,c(" "+v(e.stage.break.name),1)])):b("",!0)]),m(t(A),{show:d.isShow,"onUpdate:show":i[3]||(i[3]=S=>d.isShow=S)},{default:r(()=>[m(t(F),{style:{width:"600px"}},{default:r(()=>[m(Q,{id:d.id,onDone:W},null,8,["id"])]),_:1})]),_:1},8,["show"])]),_:1},8,["title"]))}}),oe={class:"employee-work"},ne={key:0,class:"employee-work__empty"},ie={class:"employee-work__cards"},de=C({__name:"PageEmployeeWork",setup(a){const s=N();return V(async()=>{await s.request()}),(o,l)=>(u(),_("div",oe,[m(t(K),null,{default:r(()=>[c("Текущие задачи")]),_:1}),t(s).stages.length?b("",!0):(u(),_("div",ne,[m(t(J),{size:"huge",description:"У вас нет ни одной задачи"},{extra:r(()=>[c("Пусто")]),_:1})])),y("div",ie,[(u(!0),_(I,null,R(t(s).stages,d=>(u(),f(re,{key:d.id,stage:d},null,8,["stage"]))),128))])]))}});const Be=T(de,[["__scopeId","data-v-b4f3d25b"]]);export{Be as default};
