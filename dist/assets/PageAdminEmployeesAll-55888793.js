import{a as T,N as B}from"./Select-a7e116dd.js";import{N as E,a as V}from"./Skeleton-2124448a.js";import{d as U,m as _,f as x,g as r,a as e,N as k,o as N,i as S,j as F,k as I,c as b,w as i,b as M,l as W,n as $,p as D,q,s as z}from"./index-86c80de5.js";import{u as C}from"./users.store-0c56be2d.js";import{a as R}from"./departments.store-096199fb.js";import{N as y}from"./Input-9c0e8eed.js";import{N as v,a as O}from"./FormItem-e9fb3b34.js";import{N as j}from"./DatePicker-6108359c.js";import{N as A}from"./Divider-73b01e89.js";import"./use-locale-2f8ef525.js";import"./cssr-3ada9164.js";import"./Suffix-10791576.js";import"./Empty-494d0546.js";import"./get-slot-1efb97e5.js";import"./ChevronRight-6bd0260c.js";import"./Forward-83e35121.js";const P={class:"table-user"},L=U({__name:"TableUser",props:{tableData:{},filters:{}},emits:["fire","change"],setup(g,{emit:m}){const d=g,s=u({fire:n=>{m("fire",n)},change:n=>{m("change",n)}});function u(n){return[{title:"Номер",key:"code",sorter:"default"},{title:"ФИО",key:"name",sorter:"default"},{title:"Роль",key:"role",sorter:"default"},{title:"Отделы",key:"departments",render(t){return t.departments.map(p=>_(T,{style:{marginRight:"6px"},type:"info",bordered:!1},{default:()=>p}))},filterOptions:d.filters,filter(t,p){return p.departments.indexOf(t)!==-1}},{title:"Действия",key:"actions",render(t){return[_(k,{type:"default",size:"small",style:{marginRight:"6px"},onClick:()=>n.change(t.id)},{default:()=>"Изменить"}),_(k,{type:"error",size:"small",style:{marginRight:"6px"},onClick:()=>n.fire(t.id)},{default:()=>"Уволить"})]}}]}return(n,t)=>(N(),x("div",P,[r(e(E),{data:n.tableData,"single-line":!1,columns:e(s),pagination:{pageSize:30},bordered:!0},null,8,["data","columns"])]))}});function G(g){const m={},d=S([]),s=F({code:"",lastName:"",firstName:"",patronymicName:"",startWorkDate:"2004-07-13",departments:null,login:"",password:""});return I(async()=>{var p;const u=C(),n=R(),t=u.findById(g);s.code=t.code,s.lastName=t.last_name,s.firstName=t.first_name,s.patronymicName=t.patronymic_name,s.startWorkDate=t.start_work_date,s.departments=[],s.login=t.login,(p=t.departments)==null||p.forEach(f=>{var c;(c=s.departments)==null||c.push(f.id)}),await n.request(),n.departments.forEach(f=>{d.value.push({label:f.name,value:f.id})})}),{rules:m,formValues:s,options:d}}const H=U({__name:"FormUserUpdate",props:{userId:{}},emits:["changed"],setup(g,{emit:m}){const d=g,s=S(),u=C(),{rules:n,formValues:t,options:p}=G(d.userId);async function f(){var c;(c=s.value)==null||c.validate(async a=>{a||(await u.update(d.userId,t),m("changed"))})}return(c,a)=>(N(),b(e(O),{ref_key:"userUpdateRef",ref:s,model:e(t),rules:e(n),class:"reg-form"},{default:i(()=>[r(e(v),{label:"Номер сотрудника",path:"code"},{default:i(()=>[r(e(y),{value:e(t).code,"onUpdate:value":a[0]||(a[0]=o=>e(t).code=o),placeholder:"Сгенерируется сам, если оставите незаполненным"},null,8,["value"])]),_:1}),r(e(v),{label:"Фамилия",path:"lastName"},{default:i(()=>[r(e(y),{value:e(t).lastName,"onUpdate:value":a[1]||(a[1]=o=>e(t).lastName=o),placeholder:"Иванов"},null,8,["value"])]),_:1}),r(e(v),{label:"Имя",path:"firstName"},{default:i(()=>[r(e(y),{value:e(t).firstName,"onUpdate:value":a[2]||(a[2]=o=>e(t).firstName=o),placeholder:"Иван"},null,8,["value"])]),_:1}),r(e(v),{label:"Отчество",path:"patronymicName"},{default:i(()=>[r(e(y),{value:e(t).patronymicName,"onUpdate:value":a[3]||(a[3]=o=>e(t).patronymicName=o),placeholder:"Иванович"},null,8,["value"])]),_:1}),r(e(v),{label:"Дата устройства на работу",path:"startWorkDate"},{default:i(()=>[r(e(j),{"value-format":"yyyy-MM-dd","formatted-value":e(t).startWorkDate,"onUpdate:formattedValue":a[4]||(a[4]=o=>e(t).startWorkDate=o),style:{width:"100%"},placeholder:"",type:"date"},null,8,["formatted-value"])]),_:1}),r(e(v),{label:"Департаменты",path:"departments"},{default:i(()=>[r(e(B),{value:e(t).departments,"onUpdate:value":a[5]||(a[5]=o=>e(t).departments=o),placeholder:"Минимум 1",multiple:"",remote:"",options:e(p)},null,8,["value","options"])]),_:1}),r(e(v),{label:"Логин",path:"login"},{default:i(()=>[r(e(y),{value:e(t).login,"onUpdate:value":a[6]||(a[6]=o=>e(t).login=o),placeholder:""},null,8,["value"])]),_:1}),r(e(v),{label:"Пароль",path:"password"},{default:i(()=>[r(e(y),{value:e(t).password,"onUpdate:value":a[7]||(a[7]=o=>e(t).password=o),type:"password",placeholder:"Текущий пароль захеширован и не покажется","show-password-on":"click"},null,8,["value"])]),_:1}),r(e(k),{class:"login-form__button",type:"primary",onClick:a[8]||(a[8]=W(o=>f(),["prevent"]))},{default:i(()=>[M(" Сохранить ")]),_:1})]),_:1},8,["model","rules"]))}}),J={class:"admin-users-all"},pe=U({__name:"PageAdminEmployeesAll",setup(g){const{confirm:m}=$(),d=R(),s=C(),u=F({isShow:!1,id:NaN}),n=S(!0),t=D(()=>s.users.map(l=>{const h=[];return l.departments&&l.departments.forEach(w=>{h.push(w.name)}),{id:l.id,name:[l.last_name,l.first_name,l.patronymic_name].join(" "),role:p(l.role),code:l.code,departments:h}}));function p(l){switch(l){case"manager":return"Менеджер";case"employee":return"Работник";case"storage":return"Кладовщик";case"admin":return"Админ"}}const f=D(()=>d.departments.map(l=>({label:l.name,value:l.name})));function c(l){m(async()=>{await s.fire(l)})}function a(l){u.id=l,u.isShow=!0}function o(){u.isShow=!1}return I(async()=>{await s.request(),await d.request(),n.value=!1}),(l,h)=>(N(),x("div",J,[r(e(A),{"title-placement":"left"},{default:i(()=>[M("Действующие сотрудники")]),_:1}),n.value?(N(),b(e(V),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(N(),b(L,{key:1,"pagination-behavior-on-filter":"first",onFire:c,onChange:a,"table-data":t.value,filters:f.value},null,8,["table-data","filters"])),r(e(z),{show:u.isShow,"onUpdate:show":h[1]||(h[1]=w=>u.isShow=w)},{default:i(()=>[r(e(q),{style:{width:"600px"}},{default:i(()=>[r(H,{"user-id":u.id,onChanged:h[0]||(h[0]=w=>o())},null,8,["user-id"])]),_:1})]),_:1},8,["show"])]))}});export{pe as default};
