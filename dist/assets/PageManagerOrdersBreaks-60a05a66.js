import{u as v}from"./orders-break.store-ce490f9c.js";import{d as N,f as S,g as o,a as e,o as c,m as k,N as y,i as w,j as b,k as B,c as g,w as u,b as C,l as U,n as D,q as F,s as T}from"./index-62384645.js";import{N as O,a as R}from"./Skeleton-a17865c3.js";import{u as z}from"./orderTypes.store-cd2a7c53.js";import{N as x}from"./Input-c95d618b.js";import{N as f,a as M}from"./FormItem-9db69890.js";import{N as q}from"./InputNumber-17324f83.js";import{N as I}from"./Select-8ae686c1.js";import{N as V}from"./Divider-bdda2be5.js";import"./order.service-15093fdc.js";import"./get-806e042e.js";import"./use-locale-a4cb9846.js";import"./get-slot-1efb97e5.js";import"./Suffix-86caeb40.js";import"./ChevronRight-7e3f7794.js";import"./Forward-d200b360.js";import"./Empty-6144791c.js";import"./Add-27b36ee1.js";import"./cssr-1cbf0123.js";const $={class:"table-orders-stopped"},W=N({__name:"TableOrdersBreak",props:{tableData:{}},emits:["change","stop","restore"],setup(m,{emit:p}){const s=n({change:t=>p("change",t),stop:t=>p("stop",t),restore:t=>p("restore",t)});function n(t){return[{title:"Код",key:"code",sorter:"default"},{title:"Название",key:"name",sorter:"default"},{title:"Дата начала",key:"date_start",sorter:"default"},{title:"Дата сдачи",key:"date_end",sorter:"default"},{title:"Тип",key:"type.name",sorter:"default"},{title:"Стоимость",key:"price",sorter:"default"},{title:"Брак",key:"break.name",sorter:"default"},{title:"Комментарий",key:"comment",sorter:"default"},{title:"Действия",key:"actions",width:110,render(r){return[k(y,{type:"default",size:"small",style:{marginRight:"6px",width:"100%",maxWidth:"100px"},onClick:()=>t.change(r.id)},{default:()=>"Изменить"}),k(y,{type:"primary",size:"small",style:{marginRight:"6px",marginTop:"6px",width:"100%",maxWidth:"100px"},onClick:()=>t.restore(r.id)},{default:()=>"Востановить"}),k(y,{type:"error",size:"small",style:{marginRight:"6px",marginTop:"6px",width:"100%",maxWidth:"100px"},onClick:()=>t.stop(r.id)},{default:()=>"Снять с произодства"})]}}]}return(t,r)=>(c(),S("div",$,[o(e(O),{"single-line":!1,data:t.tableData,columns:e(s),pagination:{pageSize:30},bordered:!0},null,8,["data","columns"])]))}}),j=v();function E(m){const p={name:{required:!0,message:"Введите название заказа"},type_id:{required:!0,message:"Выбирете тип заказа"}},s=w([]),n=b({name:"",type_id:void 0,price:0,comment:""});return B(async()=>{const t=z();s.value=await t.getForSelect(),n.type_id=s.value[0].value;const r=j.findById(m);r&&(n.name=r.name,n.type_id=r.type.id,n.price=r.price,n.comment=r.comment)}),{rules:p,options:s,formValues:n}}const L=N({__name:"FormOrderBreakUpdate",props:{id:{}},emits:["done"],setup(m,{emit:p}){const s=m,n=v(),t=w(),{options:r,rules:h,formValues:i}=E(s.id);function _(){var l;(l=t.value)==null||l.validate(async a=>{a||(await n.update(s.id,i),p("done"))})}return(l,a)=>(c(),g(e(M),{ref_key:"orderUpdateFormRef",ref:t,rules:e(h),model:e(i)},{default:u(()=>[o(e(f),{label:"Название заказа",path:"name"},{default:u(()=>[o(e(x),{value:e(i).name,"onUpdate:value":a[0]||(a[0]=d=>e(i).name=d),placeholder:""},null,8,["value"])]),_:1}),o(e(f),{label:"Стоимость",path:"price"},{default:u(()=>[o(e(q),{value:e(i).price,"onUpdate:value":a[1]||(a[1]=d=>e(i).price=d),placeholder:"",precision:2},null,8,["value"])]),_:1}),o(e(f),{label:"Тип вывески",path:"type_id"},{default:u(()=>[o(e(I),{value:e(i).type_id,"onUpdate:value":a[2]||(a[2]=d=>e(i).type_id=d),remote:"",options:e(r)},null,8,["value","options"])]),_:1}),o(e(f),{label:"Ваш комментарий к заказу"},{default:u(()=>[o(e(x),{value:e(i).comment,"onUpdate:value":a[3]||(a[3]=d=>e(i).comment=d),type:"textarea",placeholder:""},null,8,["value"])]),_:1}),o(e(y),{type:"primary",onClick:a[4]||(a[4]=U(d=>_(),["prevent"]))},{default:u(()=>[C(" Изменить ")]),_:1})]),_:1},8,["rules","model"]))}}),P={class:"manager-orders-breaks"},pe=N({__name:"PageManagerOrdersBreaks",setup(m){const p=D(),s=v(),n=w(!0),t=b({isShow:!1,id:NaN});B(async()=>{await s.request(),n.value=!1});async function r(l){p.confirm(async()=>{await s.stop(l)})}function h(l){t.id=l,t.isShow=!0}async function i(l){await s.restore(l)}function _(){t.isShow=!1}return(l,a)=>(c(),S("div",P,[o(e(V),{"title-placement":"left"},{default:u(()=>[C("Заказы в состоянии брака")]),_:1}),n.value?(c(),g(e(R),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(c(),g(W,{key:1,"table-data":e(s).orders,onChange:h,onStop:r,onRestore:i},null,8,["table-data"])),o(e(T),{show:t.isShow,"onUpdate:show":a[0]||(a[0]=d=>t.isShow=d)},{default:u(()=>[o(e(F),{style:{width:"600px"}},{default:u(()=>[o(L,{id:t.id,onDone:_},null,8,["id"])]),_:1})]),_:1},8,["show"])]))}});export{pe as default};
