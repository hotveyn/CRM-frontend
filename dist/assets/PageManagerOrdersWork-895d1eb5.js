import{d as b,f as D,g as a,a as e,o as y,m as T,N as I,i as k,j as x,k as F,c as g,w as l,bM as B,h as M,S as R,b as O,l as V,_ as $,q as z,s as E}from"./index-49ec2185.js";import{N as P,a as j}from"./Skeleton-b23cf947.js";import{u as S}from"./orders-work.store-ca7197c4.js";import{a as L}from"./departments.store-270a0ea0.js";import{u as A}from"./orderTypes.store-9147d02d.js";import{N as U}from"./Input-cc5e470d.js";import{N as v,a as G}from"./FormItem-d507d9a1.js";import{N as C}from"./InputNumber-fe0e6615.js";import{N as W}from"./Select-d0f19fad.js";import{N as H}from"./Switch-ccb6d10e.js";import{N as J}from"./DynamicInput-e235e603.js";import{N as K}from"./Divider-8538a625.js";import"./Suffix-5f37c512.js";import"./use-locale-f97c94a0.js";import"./get-slot-1efb97e5.js";import"./ChevronRight-2a8d5f06.js";import"./Forward-57b45e3a.js";import"./Empty-fcb2b52c.js";import"./order.service-bec46c7e.js";import"./Add-ef72f79c.js";import"./cssr-307dd1f4.js";const Q={class:"table-orders-work"},X=b({__name:"TableOrdersWork",props:{tableData:{}},emits:["change"],setup(h,{emit:m}){const p=s({change:n=>m("change",n)});function s(n){return[{title:"Код",key:"code",minWidth:110,sorter:"default"},{title:"Название",key:"name",sorter:"default"},{title:"Дата начала",key:"date_start",sorter:"default"},{title:"Дата сдачи",key:"date_end",sorter:"default"},{title:"Тип",key:"type.name",sorter:"default"},{title:"Стоимость",key:"price",sorter:"default"},{title:"Текущий этап произодства",key:"current_department",sorter:"default"},{title:"Текущий исполнитель",key:"current_user",sorter:"default"},{title:"Комментарий",key:"comment",sorter:"default"},{title:"Действия",key:"actions",width:110,render(c){return[T(I,{type:"default",size:"small",style:{marginRight:"6px"},onClick:()=>n.change(c.id)},{default:()=>"Изменить"})]}}]}return(n,c)=>(y(),D("div",Q,[a(e(P),{"single-line":!1,data:n.tableData,columns:e(p),pagination:{pageSize:30},bordered:!0},null,8,["data","columns"])]))}}),Y=S();function Z(h){const m={name:{required:!0,message:"Введите название заказа"},type:{required:!0,message:"Выбирете тип заказа"},price:{required:!0,message:"Введите длину неона"}},p={trigger:"input",validator(t,f){return console.log(f),f?!0:new Error("Сделайте выбор")}},s=k([]),n=k([]),c=k(!1),d=x({name:"",type_id:void 0,price:0,comment:"",departments:[{department_id:void 0,percent:void 0}]});F(async()=>{const t=A(),f=L();await Promise.all([t.request(),f.request()]),n.value=t.selected,console.log(n.value),console.log(f.departments);const u=Y.findById(h);u&&(d.name=u.name,d.price=u.price,d.comment=u.comment,u.type&&(d.type_id=u.type.id),d.departments=u.order_stages.map(_=>({department_id:+_.department_id,percent:_.percent}))),f.departments.forEach(_=>{s.value.push({label:_.name,value:_.id})})});function i(){return{department_id:void 0,percent:void 0}}return{rules:m,options:s,isDepartmentsChange:c,formValues:d,dynamicInputRule:p,optionsType:n,onCreateInp:i}}const ee={class:"dynamic-input"},te=b({__name:"FormOrderWorkUpdate",props:{id:{}},emits:["done"],setup(h,{emit:m}){const p=h,s=S(),n=k(),{options:c,rules:d,isDepartmentsChange:i,formValues:t,optionsType:f,onCreateInp:u,dynamicInputRule:_}=Z(p.id);function q(){var N;(N=n.value)==null||N.validate(async o=>{o||(i.value||delete t.departments,await s.update(p.id,t),m("done"))})}return(N,o)=>(y(),g(e(G),{ref_key:"orderUpdateFormRef",ref:n,rules:e(d),model:e(t)},{default:l(()=>[a(e(v),{label:"Название заказа",path:"name"},{default:l(()=>[a(e(U),{value:e(t).name,"onUpdate:value":o[0]||(o[0]=r=>e(t).name=r),placeholder:""},null,8,["value"])]),_:1}),a(e(v),{label:"Стоимость",path:"price"},{default:l(()=>[a(e(C),{value:e(t).price,"onUpdate:value":o[1]||(o[1]=r=>e(t).price=r),placeholder:"",precision:2},null,8,["value"])]),_:1}),a(e(v),{label:"Тип вывески",path:"type_id"},{default:l(()=>[a(e(W),{value:e(t).type_id,"onUpdate:value":o[2]||(o[2]=r=>e(t).type_id=r),remote:"",options:e(f)},null,8,["value","options"])]),_:1}),a(e(v),{label:"Ваш комментарий к заказу"},{default:l(()=>[a(e(U),{value:e(t).comment,"onUpdate:value":o[3]||(o[3]=r=>e(t).comment=r),type:"textarea",placeholder:""},null,8,["value"])]),_:1}),a(e(v),{label:"Поменять ли этапы работы? Если вы их поменяете процесс работы начнётся занова с первого этапа!"},{default:l(()=>[a(e(H),{value:e(i),"onUpdate:value":o[4]||(o[4]=r=>B(i)?i.value=r:null)},null,8,["value"])]),_:1}),e(i)?(y(),g(e(J),{key:0,min:1,value:e(t).departments,"onUpdate:value":o[5]||(o[5]=r=>e(t).departments=r),"on-create":e(u),"show-sort-button":""},{default:l(({index:r})=>[M("div",ee,[a(e(v),{"show-label":!1,"ignore-path-change":"",path:`departments[${r}].department_id`,rule:e(_)},{default:l(()=>[a(e(W),{value:e(t).departments[r].department_id,"onUpdate:value":w=>e(t).departments[r].department_id=w,placeholder:"Выберите отдел",remote:"",options:e(c)},null,8,["value","onUpdate:value","options"])]),_:2},1032,["path","rule"]),a(e(v),{"show-label":!1},{default:l(()=>[a(e(C),{value:e(t).departments[r].percent,"onUpdate:value":w=>e(t).departments[r].percent=w,min:0,max:100,precision:2,placeholder:"Проценты за работу",style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1024)])]),_:1},8,["value","on-create"])):R("",!0),a(e(I),{type:"primary",onClick:o[6]||(o[6]=V(r=>q(),["prevent"]))},{default:l(()=>[O(" Изменить ")]),_:1})]),_:1},8,["rules","model"]))}});const ae=$(te,[["__scopeId","data-v-0aa3d896"]]),re={class:"manager-orders-work"},Ue=b({__name:"PageManagerOrdersWork",setup(h){const m=S(),p=k(!0),s=x({isShow:!1,id:NaN});function n(d){s.id=d,s.isShow=!0}function c(){s.isShow=!1}return F(async()=>{await m.request(),p.value=!1}),(d,i)=>(y(),D("div",re,[a(e(K),{"title-placement":"left"},{default:l(()=>[O("Заказы в производстве")]),_:1}),p.value?(y(),g(e(j),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(y(),g(X,{key:1,onChange:n,"table-data":e(m).orders},null,8,["table-data"])),a(e(E),{show:s.isShow,"onUpdate:show":i[0]||(i[0]=t=>s.isShow=t)},{default:l(()=>[a(e(z),{style:{width:"600px"}},{default:l(()=>[a(ae,{id:s.id,onDone:c},null,8,["id"])]),_:1})]),_:1},8,["show"])]))}});export{Ue as default};
