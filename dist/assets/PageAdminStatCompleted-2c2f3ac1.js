import{A as J,m as g,B as Q,C as N,D as M,E as L,G as X,d as w,H as Y,I as E,J as Z,i as x,K as ee,p as z,L as te,M as ae,O as re,P as oe,Q as se,R as O,f as H,g as h,a as i,o as b,N as $,t as ne,v as le,c as V,j as B,k as q,w as _,b as j,l as ie,h as de,q as T,s as A,_ as ue}from"./index-86c80de5.js";import{N as K,a as ce}from"./Skeleton-2124448a.js";import{u as me}from"./order.service-175092c2.js";import{u as fe}from"./use-locale-2f8ef525.js";import{N as pe,a as he}from"./FormItem-e9fb3b34.js";import{N as ve}from"./Divider-73b01e89.js";import"./Suffix-10791576.js";import"./get-slot-1efb97e5.js";import"./Select-a7e116dd.js";import"./cssr-3ada9164.js";import"./Empty-494d0546.js";import"./ChevronRight-6bd0260c.js";import"./Forward-83e35121.js";import"./Input-9c0e8eed.js";const _e=e=>{const{railColor:a}=e;return{itemColor:a,itemColorActive:"#FFCC33",sizeSmall:"16px",sizeMedium:"20px",sizeLarge:"24px"}},ge={name:"Rate",common:J,self:_e},ye=ge,Ce=g("svg",{viewBox:"0 0 512 512"},g("path",{d:"M394 480a16 16 0 01-9.39-3L256 383.76 127.39 477a16 16 0 01-24.55-18.08L153 310.35 23 221.2a16 16 0 019-29.2h160.38l48.4-148.95a16 16 0 0130.44 0l48.4 149H480a16 16 0 019.05 29.2L359 310.35l50.13 148.53A16 16 0 01394 480z"})),be=Q("rate",{display:"inline-flex",flexWrap:"nowrap"},[N("&:hover",[M("item",`
 transition:
 transform .1s var(--n-bezier),
 color .3s var(--n-bezier);
 `)]),M("item",`
 position: relative;
 display: flex;
 transition:
 transform .1s var(--n-bezier),
 color .3s var(--n-bezier);
 transform: scale(1);
 font-size: var(--n-item-size);
 color: var(--n-item-color);
 `,[N("&:not(:first-child)",`
 margin-left: 6px;
 `),L("active",`
 color: var(--n-item-color-active);
 `)]),X("readonly",`
 cursor: pointer;
 `,[M("item",[N("&:hover",`
 transform: scale(1.05);
 `),N("&:active",`
 transform: scale(0.96);
 `)])]),M("half",`
 display: flex;
 transition: inherit;
 position: absolute;
 top: 0;
 left: 0;
 bottom: 0;
 width: 50%;
 overflow: hidden;
 color: rgba(255, 255, 255, 0);
 `,[L("active",`
 color: var(--n-item-color-active);
 `)])]),Se=Object.assign(Object.assign({},E.props),{allowHalf:Boolean,count:{type:Number,default:5},value:Number,defaultValue:{type:Number,default:null},readonly:Boolean,size:{type:[String,Number],default:"medium"},clearable:Boolean,color:String,onClear:Function,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array]}),we=w({name:"Rate",props:Se,setup(e){const{mergedClsPrefixRef:a,inlineThemeDisabled:r}=Y(e),o=E("Rate","-rate",be,ye,e,a),t=Z(e,"value"),c=x(e.defaultValue),v=x(null),u=ee(e),f=fe(t,c);function n(l){const{"onUpdate:value":d,onUpdateValue:m}=e,{nTriggerFormChange:S,nTriggerFormInput:C}=u;d&&O(d,l),m&&O(m,l),c.value=l,S(),C()}function s(l,d){return e.allowHalf?d.offsetX>=Math.floor(d.currentTarget.offsetWidth/2)?l+1:l+.5:l+1}let p=!1;function k(l,d){p||(v.value=s(l,d))}function R(){v.value=null}function W(l,d){var m;const{clearable:S}=e,C=s(l,d);S&&C===f.value?(p=!0,(m=e.onClear)===null||m===void 0||m.call(e),v.value=null,n(null)):n(C)}function G(){p=!1}const D=z(()=>{const{size:l}=e,{self:d}=o.value;return typeof l=="number"?`${l}px`:d[oe("size",l)]}),F=z(()=>{const{common:{cubicBezierEaseInOut:l},self:d}=o.value,{itemColor:m,itemColorActive:S}=d,{color:C}=e;return{"--n-bezier":l,"--n-item-color":m,"--n-item-color-active":C||S,"--n-item-size":D.value}}),y=r?te("rate",z(()=>{const l=D.value,{color:d}=e;let m="";return l&&(m+=l[0]),d&&(m+=se(d)),m}),F,e):void 0;return{mergedClsPrefix:a,mergedValue:f,hoverIndex:v,handleMouseMove:k,handleClick:W,handleMouseLeave:R,handleMouseEnterSomeStar:G,cssVars:r?void 0:F,themeClass:y==null?void 0:y.themeClass,onRender:y==null?void 0:y.onRender}},render(){const{readonly:e,hoverIndex:a,mergedValue:r,mergedClsPrefix:o,onRender:t,$slots:{default:c}}=this;return t==null||t(),g("div",{class:[`${o}-rate`,{[`${o}-rate--readonly`]:e},this.themeClass],style:this.cssVars,onMouseleave:this.handleMouseLeave},ae(this.count,(v,u)=>{const f=c?c({index:u}):g(re,{clsPrefix:o},{default:()=>Ce}),n=a!==null?u+1<=a:u+1<=(r||0);return g("div",{key:u,class:[`${o}-rate__item`,n&&`${o}-rate__item--active`],onClick:e?void 0:s=>{this.handleClick(u,s)},onMouseenter:this.handleMouseEnterSomeStar,onMousemove:e?void 0:s=>{this.handleMouseMove(u,s)}},f,this.allowHalf?g("div",{class:[`${o}-rate__half`,{[`${o}-rate__half--active`]:!n&&a!==null?u+.5<=a:u+.5<=(r||0)}]},f):null)}))}}),ke={class:"table-orders-ready"},Re=w({__name:"TableOrdersCompleted",props:{tableData:{}},emits:["detail","rate"],setup(e,{emit:a}){const r=o({detail:t=>a("detail",t),rate:t=>a("rate",t)});function o(t){return[{title:"Код",key:"code",sorter:"default"},{title:"Название",key:"name",sorter:"default"},{title:"Дата начала",key:"date_start",sorter:"default"},{title:"Дата сдачи",key:"date_end",sorter:"default"},{title:"Тип",key:"type.name",sorter:"default"},{title:"Стоимость",key:"price",sorter:"default"},{title:"Оценка",key:"rating",sorter:"default"},{title:"Комментарий",key:"comment",sorter:"default"},{title:"Действия",key:"actions",width:110,render(c){return[g($,{type:"default",size:"small",style:{marginRight:"6px"},onClick:()=>t.detail(c.id)},{default:()=>"Детали"}),g($,{type:"primary",size:"small",style:{marginRight:"6px"},onClick:()=>t.rate(c.id)},{default:()=>"Оценить"})]}}]}return(t,c)=>(b(),H("div",ke,[h(i(K),{"single-line":!1,data:t.tableData,columns:i(r),pagination:{pageSize:30},bordered:!0},null,8,["data","columns"])]))}}),P=me(),U=ne(),I=le("orders-completed",{state:()=>({orders:[]}),actions:{async request(){this.orders=await P.getCompleted()},findById(e){return this.orders.find(a=>a.id===e)},async setRating(e,a){await P.setRating(e,a).then(()=>{U.order.rated();for(const r in this.orders)if(this.orders[r].id===e){this.orders[r].rating=a;break}}).catch(r=>U.error.custom(r.response.data.message))}}}),Ne=w({__name:"TableOrdersDetails",props:{tableData:{}},setup(e){function a(){return[{title:"В порядке",key:"in_order",sorter:"default",defaultSortOrder:"ascend"},{title:"Отдел",key:"department.name",sorter:"default"},{title:"Сотрудник",key:"full_name",sorter:"default"},{title:"Процент",key:"percent",sorter:"default"}]}return(r,o)=>(b(),V(i(K),{"single-line":!1,data:r.tableData,columns:a(),bordered:!0},null,8,["data","columns"]))}});function Me(e){const a={rating:{required:!0,message:"Оцените заказ"}},r=B({rating:0});return q(()=>{const t=I().findById(e);t&&(r.rating=t.rating)}),{rules:a,formValues:r}}const ze=w({__name:"FormOrderRate",props:{id:{}},emits:["done"],setup(e,{emit:a}){const r=e,{rules:o,formValues:t}=Me(r.id),c=I(),v=x();function u(){var f;(f=v.value)==null||f.validate(async n=>{n||(await c.setRating(r.id,t.rating*2),a("done"))})}return(f,n)=>(b(),V(i(he),{ref_key:"orderRateFormRef",ref:v,rules:i(o),model:i(t)},{default:_(()=>[h(i(pe),{path:"rating",label:"Оценка"},{default:_(()=>[h(i(we),{value:i(t).rating,"onUpdate:value":n[0]||(n[0]=s=>i(t).rating=s),size:"large","allow-half":""},null,8,["value"])]),_:1}),h(i($),{type:"primary",onClick:n[1]||(n[1]=ie(s=>u(),["prevent"]))},{default:_(()=>[j("Оценить")]),_:1})]),_:1},8,["rules","model"]))}}),xe={class:"admin-stat-ready"},Ve={class:"admin-stat-ready__table"},$e=w({__name:"PageAdminStatCompleted",setup(e){const a=I(),r=x(!0),o=B({isShow:!1,id:NaN}),t=B({isShow:!1,id:NaN}),c=z(()=>{if(o.id){const n=a.findById(o.id);if(n)return n.order_stages.map(s=>{var p,k,R;return{...s,full_name:`${(p=s.user)==null?void 0:p.last_name} ${(k=s.user)==null?void 0:k.first_name} ${(R=s.user)==null?void 0:R.patronymic_name}`}})}return[]});function v(n){o.isShow=!0,o.id=n}function u(n){t.isShow=!0,t.id=n}function f(){t.isShow=!1}return q(async()=>{await a.request(),r.value=!1}),(n,s)=>(b(),H("div",xe,[h(i(ve),{"title-placement":"left"},{default:_(()=>[j("Выполненные заказы")]),_:1}),de("div",Ve,[r.value?(b(),V(i(ce),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(b(),V(Re,{key:1,"table-data":i(a).orders,onDetail:v,onRate:u},null,8,["table-data"]))]),h(i(A),{show:o.isShow,"onUpdate:show":s[0]||(s[0]=p=>o.isShow=p)},{default:_(()=>[h(i(T),{style:{width:"600px"}},{default:_(()=>[h(Ne,{"table-data":c.value},null,8,["table-data"])]),_:1})]),_:1},8,["show"]),h(i(A),{show:t.isShow,"onUpdate:show":s[2]||(s[2]=p=>t.isShow=p)},{default:_(()=>[h(i(T),{style:{width:"600px"}},{default:_(()=>[h(ze,{id:t.id,onDone:s[1]||(s[1]=p=>f())},null,8,["id"])]),_:1})]),_:1},8,["show"])]))}});const Ke=ue($e,[["__scopeId","data-v-2cc94fe3"]]);export{Ke as default};
