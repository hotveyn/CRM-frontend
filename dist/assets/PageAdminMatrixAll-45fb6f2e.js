import{d as b,c as h,a as l,o as d,y as u,t as M,v as S,i as m,k as N,m as w,f as x,g as p,w as g,F as k,l as z,b as y,N as C,_ as A}from"./index-3479dd01.js";import{N as D,a as B}from"./Skeleton-c3879c1d.js";import{a as q}from"./departments.store-13cfb092.js";import{N as O}from"./InputNumber-1736ecba.js";import{N as P}from"./Divider-e31872c8.js";import"./Suffix-cc808f9e.js";import"./use-locale-ad4756e2.js";import"./get-slot-1efb97e5.js";import"./Select-1f7edc5b.js";import"./cssr-95788e2e.js";import"./Empty-9a754558.js";import"./ChevronRight-08fa84b8.js";import"./Forward-150f3a5e.js";import"./Input-bda83dc5.js";import"./Add-39e399b0.js";const T=b({__name:"TableMatrix",props:{tableData:{},departmentColumns:{}},setup(r){const t=r,s=e();function e(){return[{title:"Тип вывески",key:"order_type.name",sorter:"default"},...t.departmentColumns,{title:"Сумма",key:"sum",sorter:"default"}]}return(i,a)=>(d(),h(l(D),{"single-line":!1,data:i.tableData,columns:l(s),bordered:!0},null,8,["data","columns"]))}});function U(){return{async getSerialized(){return(await u.get("/monetary-matrix/ser-to-table")).data},async getAll(){return(await u.get("/monetary-matrix/")).data},async bulkUpdate(r){return(await u.patch("/monetary-matrix/bulk-update",{matrices:r})).data}}}const v=U(),V=M(),$=S("matrix",{state:()=>({matrices:[],serializedMatrices:[]}),actions:{async requestSerialized(){this.serializedMatrices=await v.getSerialized()},async update(r){const t=[];for(let s=0;s<r.length;s++){const e=this.serializedMatrices[s],i=r[s];Object.keys(e).forEach(a=>{if(a!=="order_type"&&e[a].percent!==i[a].percent){const n=i[a];e[a].percent=i[a].percent,t.push({order_type_id:+n.order_type_id,department_id:+n.department_id,percent:n.percent})}})}t.length&&(await v.bulkUpdate(t),V.matrix.updated())},getCopy(){return JSON.parse(JSON.stringify(this.serializedMatrices))}}}),E={class:"admin-matrix-all"},F=b({__name:"PageAdminMatrixAll",setup(r){const t=$(),s=q(),e=m([]),i=m(!0),a=m([]);async function n(){await t.update(e.value)}return N(async()=>{await t.requestSerialized(),await s.request(),e.value=t.getCopy(),a.value=s.departments.map(o=>({title:o.name,key:`${o.id}.percent`,sorter:"default",render(c,_){return w(O,{value:c[o.id].percent,min:0,precision:2,max:100,onUpdateValue(f){f&&(e.value[_][o.id].percent=f)}})}})),i.value=!1}),(o,c)=>(d(),x("div",E,[p(l(P),{"title-placement":"left"},{default:g(()=>[y("Матрица оплаты")]),_:1}),i.value?(d(),h(l(B),{key:0,width:"100%",height:"52px",sharp:!1,text:"",size:"medium",repeat:5})):(d(),x(k,{key:1},[p(T,{"table-data":e.value,"department-columns":a.value},null,8,["table-data","department-columns"]),p(l(C),{class:"admin-matrix-all__save-button",disabled:!e.value.length,type:"primary",onClick:c[0]||(c[0]=z(_=>n(),["prevent"]))},{default:g(()=>[y(" Сохранить ")]),_:1},8,["disabled"])],64))]))}});const ae=A(F,[["__scopeId","data-v-c17acb92"]]);export{ae as default};
